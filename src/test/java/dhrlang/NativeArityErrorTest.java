package dhrlang;
import dhrlang.error.ErrorReporter;import dhrlang.parser.Parser;import dhrlang.lexer.Lexer;import dhrlang.ast.Program;import dhrlang.typechecker.TypeChecker;import org.junit.jupiter.api.Test;import static org.junit.jupiter.api.Assertions.*;import java.util.stream.Collectors;import dhrlang.error.ErrorCode;
public class NativeArityErrorTest { 
 @Test public void testNativeArityMismatchPrint() { String src="class Main { static kaam main() { print(); } }"; ErrorReporter er=new ErrorReporter("test.dhr",src); Lexer lx=new Lexer(src); Parser p=new Parser(lx.scanTokens()); Program prog=p.parse(); TypeChecker tc=new TypeChecker(er); tc.check(prog); assertTrue(er.hasErrors(),"Expected errors"); String codes=er.getErrors().stream().map(e-> e.getCode()==null?"NONE":e.getCode().name()).collect(Collectors.joining(",")); assertTrue(codes.contains(ErrorCode.NATIVE_ARITY.name())||codes.contains("NONE"),"Expect at least some error; print currently handled separately: "+codes); }
 @Test public void testNativeArityMismatchSubstring() { String src="class Main { static kaam main() { substring(\"abc\",1); } }"; ErrorReporter er=new ErrorReporter("test2.dhr",src); Lexer lx=new Lexer(src); Parser p=new Parser(lx.scanTokens()); Program prog=p.parse(); TypeChecker tc=new TypeChecker(er); tc.check(prog); assertTrue(er.hasErrors(),"Expected errors"); String codes=er.getErrors().stream().map(e-> e.getCode()==null?"NONE":e.getCode().name()).collect(Collectors.joining(",")); assertTrue(codes.contains(ErrorCode.NATIVE_ARITY.name()),"Expected NATIVE_ARITY in "+codes); }
}
